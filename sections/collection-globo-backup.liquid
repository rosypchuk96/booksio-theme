{% assign host = request.host %}
{% assign host_arr = host | split: '.' %}
{% if host_arr.size >= 3 %}
  {% assign subdomain = host_arr[0] %}
{% endif %}

{% paginate collection.products by 32 %}
  <div id="main-content" class="page-main page-wrapper">
  <nav class="breadcrumbs" aria-label="breadcrumbs">
    <ul class="items">
      <li class="item home">
        <a href="/" title="Go to Home Page">Home</a>
        <span class="icon" aria-hidden="true"></span>
      </li>
      {% if collection.metafields.custom.parent_category %}
        <li class="item">
          {% assign collection_parent = collections[collection.metafields.custom.parent_category] %}
          <a href="{{ collection_parent.url }}" >{{ collection_parent.title }}</a>
          <span class="icon" aria-hidden="true"></span>
        </li>
      {% endif %}
      <li class="item category6940">
        <strong>{{ collection.title }}</strong>
      </li>
    </ul>
  </nav>
  <div class="columns">
    <div class="column main">
       <input name="form_key" type="hidden" value="UxbR7TJdQwixPtD6"> 
       <div id="authenticationPopup" data-bind="scope:'authenticationPopup', style: {display: 'none'}" style="display: none;">
          <!-- ko template: getTemplate() -->
          <!-- /ko -->
       </div>
       <div></div>
       <!-- Yotpo - Add body class --><!--/ Yotpo - Add body class --><!-- Yotpo - Widget Script --><!--/ Yotpo - Widget Script -->           
       <div class="toolbar toolbar-products">
        {% assign shown = paginate.page_size | plus: paginate.current_offset %}
        <p class="toolbar-amount" id="toolbar-amount"> Show <span class="toolbar-number">{% if shown < collection.products_count %}{{ shown }}{% else %}{{ collection.products_count }}{% endif %}</span> Items total of <span class="toolbar-number">{{ collection.products_count }}</span> </p>
          <div class="toolbar-sorter sorter">
             <label class="sorter-label" for="sorter">Sort By</label> 
             <select id="sorter" data-role="sorter" class="sorter-options">
                <option value="" {% unless collection.sort_by %}selected="selected"{% endunless %} disabled="true">Sort By</option>
                <option value="best-selling" {% if collection.sort_by == 'best-selling' %}selected="selected"{% endif %}>Best Sellers</option>
                <option value="title-ascending"{% if collection.sort_by == 'title-ascending' %}selected="selected"{% endif %}>Product Name</option>
                <option value="created-descending"{% if collection.sort_by == 'created-descending' %}selected="selected"{% endif %}>Publish Date</option>
             </select>
             <a title="Set Ascending Direction" href="#" class="action sorter-action sort-desc" data-role="direction-switcher" data-value="asc"><span class="visually-hidden">Set Ascending Direction</span> <i class="icon" aria-hidden="true"></i></a> 
          </div>
          <div class="field limiter">
             <label class="label" for="limiter"></label> 
             <div class="control">
                <select id="limiter" data-role="limiter" class="limiter-options">
                   <option value="32" selected="selected">32</option>
                   <option value="48">48</option>
                </select>
                <ul>
                   <li data-value="32" class="active"><a style="color:inherit;" href="{{ collection.url | append: '?view=32' }}">32</a></li>
                   <li data-value="48"><a style="color:inherit;" href="{{ collection.url | append: '?view=48' }}">48</a></li>
                </ul>
             </div>
          </div>
       </div>

       <div class="products wrapper grid products-grid">
          <ol class="products list items product-items">
            {% for product in collection.products %}
              {% include 'card-product-collection' with product %}
            {% endfor %}
          </ol>
       </div>
       
       <div class="toolbar toolbar-products">
        {%- if paginate.pages > 1 -%}
          <div class="pages">
             <strong class="label pages-label" id="paging-label">Page</strong> 
             <ul class="items pages-items" aria-labelledby="paging-label">
              {% if paginate.previous %}
                <li class="item pages-item-previous"> 
                  <a class="action previous" href="{{ paginate.previous.url }}" title="Previous"><span class="label">Page</span> <span>Previous</span> <i class="icon" aria-hidden="true"></i></a>
                  </li>
              {% endif %}
              {%- for part in paginate.parts -%}
                {%- if part.title == paginate.current_page -%}
                 {% assign current_url = part.url %}
                 {{ part }}
                {%- endif -%}
              {%- endfor -%}
              {% assign max = paginate.pages %}
              {% assign prev = paginate.current_page | minus: 2 %}
              {% assign prev_2 = paginate.current_page | minus: 3 %}
              {% assign next = paginate.current_page %}
              {% assign next_2 = paginate.current_page | plus: 1 %}
              {% if prev_2 > -1 %}
                <li class="item"><a href="{{ paginate.parts[prev_2].url }}" class="page"><span class="label">Page</span> <span>{{ prev_2 | plus: 1 }}</span></a></li>
              {% endif %}
              {% if prev > -1 %}
                <li class="item"><a href="{{ paginate.parts[prev].url }}" class="page"><span class="label">Page</span> <span>{{ prev | plus: 1 }}</span></a></li>
              {% endif %}
              <li class="item current"><strong class="page"> <span>{{ paginate.current_page }}</span></strong></li>
              
              {% if next < max %}
                <li class="item"><a href="{{ paginate.parts[next].url }}" class="page"><span class="label">Page</span> <span>{{ next | plus: 1 }}</span></a></li>
              {% endif %}
              {% if next_2 < max %}
                <li class="item"><a href="{{ paginate.parts[next_2].url }}" class="page"><span class="label">Page</span> <span>{{ next_2 | plus: 1 }}</span></a></li>
              {% endif %}
              {% if paginate.next %}
                <li class="item pages-item-next"> <a class="action next" href="{{ paginate.next.url }}" title="Next"><span class="label">Page</span> <span>Next</span> <i class="icon" aria-hidden="true"></i></a></li>
              {% endif %}
             </ul>
          </div>
        {%- endif -%}
        <div class="field limiter">
            <label class="label" for="limiter"></label> 
            <div class="control">
              <select id="limiter" data-role="limiter" class="limiter-options">
                  <option value="32" selected="selected">32</option>
                  <option value="48">48</option>
              </select>
              <ul>
                  <li data-value="32" class="active">32</li>
                  <li data-value="48" class="">48</li>
              </ul>
            </div>
        </div>
       </div>
    </div>
    <div class="sidebar sidebar-main" {% if subdomain %}style="display: none;"{% endif %}>


        <div class="block filter" id="layered-filter-block" data-collapsible="true">
          <div class="block-title filter-title" data-count="0" role="tablist"><strong data-role="title" role="tab" aria-selected="false" aria-expanded="false" tabindex="0">Shop By</strong></div>
          <div class="block-content filter-content">
            {% for filter in collection.filters %}
              {% if filter.active_values.size > 0 or filter.max_value.value or filter.min_value.value %}
                <div class="filter-current active" data-collapsible="true" role="tablist">
                  <strong class="block-subtitle filter-current-subtitle" id="nowShoppingBy" role="tab" aria-level="2" data-role="title" data-count="2" aria-selected="false" aria-expanded="true" tabindex="0">Now Shopping by</strong> 
                  {% for filter_2 in collection.filters %}
                    {% if filter_2.type == 'price_range' %}
                      <ol class="items">
                          <li class="item"> <span class="filter-label filter-price">{{ filter_2.label }}</span>  <span class="filter-value">{{ filter_2.min_value.value | money }} - {{ filter_2.max_value.value | money }}</span>   <a class="action remove" href="{{ filter_2.url_to_remove }}" title="Remove Filter by Price {{ filter_2.min_value.value | money }} - {{ filter_2.max_value.value | money }}"><span>Remove This Item</span> <i class="icon" aria-hidden="true"></i></a> </li>
                      </ol>
                    {% endif %}
                    {% if filter_2.type == 'list'  %}
                      <ol class="items">  
                        {% for value in filter_2.active_values %}
                          <li class="item"> 
                            <span class="filter-label">{{ filter_2.label }}</span> 
                            <span class="filter-value">{{ value.label }}</span>   <a class="action remove" href="{{ value.url_to_remove }}" title="Remove"><span>Remove This Item</span> <i class="icon" aria-hidden="true"></i></a> </li>  
                        {% endfor %} 
                        </ol>
                    {% endif %}
                  {% endfor %}
                </div>
                <div class="block-actions filter-actions"><a href="#" class="action clear filter-clear"><span></span></a></div>
                {% break %}
              {% endif %}
            {% endfor %}
             <strong role="heading" aria-level="2" class="block-subtitle filter-subtitle">Filter By</strong> 
             <div class="filter-options" id="narrow-by-list" data-role="content" role="tablist">
                {% for filter in collection.filters %}
                  {% if filter.type == 'price_range' %}
                    <div data-role="collapsible" class="filter-options-item allow" role="presentation" data-collapsible="true">
                      <div data-role="title" class="filter-options-title" role="tab" aria-selected="true" aria-expanded="true" tabindex="0"><span> {{ filter.label }}</span> <i class="icon" aria-hidden="true"></i></div>
                      <div data-role="content" class="filter-options-content" role="tabpanel" style="display: none;">
                        <div class="smile-es-range-slider" data-role="range-price-slider-price">
                          <div class="from-label" data-role="from-label" data-val="0.00">$0.00</div>
                          <div class="to-label" data-role="to-label" data-val="{{ filter.range_max | money_without_currency }}">{{ filter.range_max | money_without_currency }}</div>
                          <div id="slider-bar">
                          </div>
                          <div class="actions-toolbar">
                              <div data-role="message-box"></div>
                              <div class="actions-primary"><a class="action primary small" id="update-price" data-role="apply-range" data-url-to-remove="{{ filter.url_to_remove }}"><span>OK</span></a></div>
                          </div>
                        </div>
                      </div>
                    </div>
                  {% elsif filter.type == 'list' %}
                    <div data-role="collapsible" class="filter-options-item" role="presentation" data-collapsible="true">
                      <div data-role="title" class="filter-options-title" role="tab" aria-selected="false" aria-expanded="false" tabindex="0"><span> {{ filter.label }}</span> <i class="icon" aria-hidden="true"></i></div>
                      <div data-role="content" class="filter-options-content" role="tabpanel" style="display: none;">
                          <div data-bind="scope: 'product_type_indicatorFilter'">
                            <ol class="items" id="bookFormatSelector" data-bind="foreach: getDisplayedItems()">
                              {% for value in filter.values %}
                                <li class="item" data-bind="attr: { 'data-label': label }" data-label="Paperback">
                                  {% if value.active %}
                                  <a href="{{ value.url_to_remove }}" rel="">
                                  {% else %}
                                  <a href="{{ value.url_to_add }}" rel="">
                                  {% endif %}
                                    <input type="checkbox" {% if value.active %}checked{% endif %}>
                                    <label data-bind="attr: { for: id }" for="product_type_indicatorFilter_option_1">
                                    <span data-bind="html: label">{{ value.label }}</span>
                                    </label>
                                  </a>
                                </li>
                              {% endfor %}
                            </ol>
                          </div>
                      </div>
                    </div>
                  {% endif %}
                {% endfor %}
             </div>
          </div>
       </div>
       <div class="row image-middel">
          <div class="middle-banner">
             <style>#html-body [data-pb-style=ILGK9DO]{justify-content:center;display:flex;flex-direction:column;background-position:left top;background-size:cover;background-repeat:no-repeat;background-attachment:scroll;border-width:0}#html-body [data-pb-style=EW150M2]{border-width:0}#html-body [data-pb-style=BCKMI5C]{text-align:center;border-style:none}#html-body [data-pb-style=ETXW5VS],#html-body [data-pb-style=OU8TDCP]{border-width:0;max-width:100%;height:auto}@media only screen and (max-width: 768px) { #html-body [data-pb-style=BCKMI5C]{border-style:none} }</style>
             <div data-content-type="row" data-appearance="full-width" data-enable-parallax="0" data-parallax-speed="0.5" data-background-images="{}" data-background-type="image" data-video-loop="true" data-video-play-only-visible="true" data-video-lazy-load="true" data-video-fallback-src="" data-box-model="{&quot;desktop&quot;:{&quot;margin&quot;:{&quot;top&quot;:&quot;0px&quot;,&quot;right&quot;:&quot;0px&quot;,&quot;bottom&quot;:&quot;0px&quot;,&quot;left&quot;:&quot;0px&quot;},&quot;padding&quot;:{&quot;top&quot;:&quot;0px&quot;,&quot;right&quot;:&quot;0px&quot;,&quot;bottom&quot;:&quot;0px&quot;,&quot;left&quot;:&quot;0px&quot;}}}" data-element="main" data-pb-style="ILGK9DO" class="box-model-64af6218f3bca">
                <div class="row-full-width-inner" data-element="inner">
                   <div data-content-type="html" data-appearance="default" data-box-model="{&quot;desktop&quot;:{&quot;margin&quot;:{&quot;top&quot;:&quot;0px&quot;,&quot;right&quot;:&quot;0px&quot;,&quot;bottom&quot;:&quot;0px&quot;,&quot;left&quot;:&quot;0px&quot;},&quot;padding&quot;:{&quot;top&quot;:&quot;0px&quot;,&quot;right&quot;:&quot;0px&quot;,&quot;bottom&quot;:&quot;0px&quot;,&quot;left&quot;:&quot;0px&quot;}}}" data-element="main" data-pb-style="EW150M2" data-decoded="true" class="box-model-64af6218f3bdb">
                      <style>
                         .middle-banner + img {
                         display: none;
                         }
                         .middle-banner [data-content-type=row][data-appearance=full-width]>.row-full-width-inner {
                         padding: 0;
                         }
                      </style>
                   </div>
                   <figure data-content-type="image" data-appearance="full-width" data-element="main" data-pb-style="BCKMI5C" class="box-model-64af6218f3be6">
                      <a href="{{ settings.sidebar_banner_link }}" target="" data-link-type="default" data-element="link">
                        {% if settings.sidebar_banner_img != blank %}
                          <img class="pagebuilder-mobile-hidden box-model-64af6218f3bf0" src="{{ settings.sidebar_banner_img | img_url: 'master' }}" alt="{{ settings.sidebar_banner_img.alt }}" data-element="desktop_image" data-pb-style="ETXW5VS">
                          <img class="pagebuilder-mobile-only box-model-64af6218f3bfa" src="{{ settings.sidebar_banner_img | img_url: 'master' }}" alt="{{ settings.sidebar_banner_img.alt }}" data-element="mobile_image" data-pb-style="OU8TDCP">
                        {% endif %}
                      </a>
                   </figure>
                </div>
             </div>
          </div>
          <img src="https://www.booksio.com/media/wysiwyg/middle-banner.png" alt="Middle Banner">
       </div>
    </div>
  </div>
</div>
{% endpaginate %}

{{ 'jquery-ui.min.css' | asset_url | stylesheet_tag }}
{{ 'jquery-ui.theme.min.css' | asset_url | stylesheet_tag }}
{{ 'jquery-ui.min.js' | asset_url | script_tag }}
{{ 'jquery.ui.touch-punch.min.js' | asset_url | script_tag }}
{{ 'collection.js' | asset_url | script_tag }}

<style>
  .breadcrumbs {
    display: block !important;
  }
  .ui-slider-horizontal .ui-slider-handle {
    top: 0;
  }
</style>

<script>
  Shopify.queryParams = {};
  if(location.search.length) {
    for(var aKeyValue, i = 0, aCouples = location.search.substr(1).split('&'); i < aCouples.length; i++) {
      aKeyValue = aCouples[i].split('=');
      if (aKeyValue.length > 1) {
        Shopify.queryParams[decodeURIComponent(aKeyValue[0])] = decodeURIComponent(aKeyValue[1]);
      }
    }
  }

  // Add existing sort parameters to current URL
  document.querySelector('#sorter').addEventListener('change', function(e) {
    var value = e.currentTarget.value;
    Shopify.queryParams.sort_by = value;
    location.search = new URLSearchParams(Shopify.queryParams).toString();
  });
</script>

{% schema %}
  {
    "name": "Collection",
    "presets": [
      {
        "category": "Custom Content",
        "name": "Collection"
      }
    ]
  }
{% endschema %}