let interval = setInterval(() => {
  let isCSSLoaded = true;
  Array.from(document.querySelectorAll("link[rel='stylesheet']"), function (elem) {
    if (!Boolean(elem.sheet)) {
      isCSSLoaded = false;
    }
  });
  if (isCSSLoaded) {
    document.body.style.visibility = "visible";
    clearInterval(interval);
  }
}, 500);

$(document).ready(function () {
  $("input#search, .usf-popup input, input#search_mobile, input[name='q']").on('keyup', function (e) {
    var t = setInterval(function () {
      if (Window.searchBarResults.length) {
        clearInterval(t);
        var result = [];
        for (var i in Window.searchBarResults) {
          var item = Window.searchBarResults[i];
          if (!item.urlName.includes('/products')) {
            item.urlName = '/products/' + item.urlName.split('?')[0];
          }
          var restricted = false;
          if (restrictedTags && item.tags) {
            for (var i in item.tags) {
              if (restrictedTags.includes(item.tags[i].toLowerCase())) {
                restricted = true;
              }
            }
          }
          if (restrictedFormats && !restricted) {
            for (var j in item.options) {
              var option = item.options[j];
              if (option.name == 'Format' || option.name == 'Type') {
                for (var k in option.values) {
                  if (!restrictedFormats.includes(option.values[k].toLowerCase())) {
                    item.urlName = item.urlName.split('?')[0] + '?variant=' + item.variants[k].id;
                    result.push(item);
                    break;
                  } else {
                  }
                }
              }
            }
          } else {
            if (!restricted) {
              result.push(item);
            }
          }
          if (result.length >= 6) {
            break;
          }
        }
        if (result.length) {
          var html = '';
          for (var i in result) {
            var product = result[i];
            var productImg = product.images.length ? `<img src="${product.images[0].url}" class="usf-img">` : "";
            var author = "";
            if (product.metafields.length) {
              for (var j in product.metafields) {
                if (product.metafields[j].namespace && product.metafields[j].key && product.metafields[j].namespace == 'custom' && product.metafields[j].key == 'author') {
                  author += `<div class="usf-author usf-vendor">${product.metafields[j].value}</div>`;
                }
              }
            }
            html += `
            <a href=${result[i].urlName} class="usf-is-product usf-clear">
              <div class="usf-img-wrapper usf-pull-left">
                ${productImg}
              </div> 
              <div class="usf-pull-left">
                <button class="usf-title usf-btn">${product.title}</button> 
                <div class="usf-vendor"></div> 
                <div>
                  ${author}
                </div>
              </div>
            </a>
            `;
          }
          $('.usf-is-products .products-wrap').html(html);
        }
      }
      clearTimeout(t);
    }, 300);
});

$('.nav-toggle').click(function () {
  $('html').toggleClass('nav-open');
});
$('.nav-sections-item-title').click(function () {
  $(this).siblings().removeClass('active');
  $(this).addClass('active');
  $('.nav-sections-item-content').hide(0).attr('aria-hidden', 'false');
  $(this).next('.nav-sections-item-content').show(0).attr('aria-hidden', 'true');
});
$('header .opener').click(function () {
  if ($(this).closest('.nav-item').hasClass('ninjamenus-toggle-active')) {
    $(this).siblings('.item-submenu').find('.item-submenu').hide(0);
    $(this).siblings('.item-submenu').hide(0);
  } else {
    $(this).siblings('.item-submenu').find('.item-submenu').show(0);
    $(this).siblings('.item-submenu').show(0);
  }
  $(this).closest('.nav-item').toggleClass('ninjamenus-toggle-active');
});
$('header .nav-item.mega').hover(function () {
  if ($(window).width() >= 1025) {
    $(this).find('.item-submenu').show(0);
  }
}, function () {
  if ($(window).width() >= 1025) {
    $(this).find('.item-submenu').hide(0);
  }
});
if (document.getElementById("top-categories")) {
  $("#top-categories").slick({ infinite: true, slidesToShow: 2, slidesToScroll: 2, dots: false, arrows: true });
}
if (document.getElementById("charities-support")) {
  $("#charities-support").slick({ infinite: true, slidesToShow: 2, slidesToScroll: 2, dots: false, arrows: true });
}
$(".widget-product-carousel:not(.widget-product-carousel-free-download)").slick({
  infinite: true,
  slidesToShow: 4,
  slidesToScroll: 4,
  dots: false,
  arrows: true,
  variableWidth: true,
  repsonsive: [
    {
      breakpoint: 768,
      settings: {
        slidesToShow: 2,
        slidesToScroll: 2,
      }
    }
  ]
});
$(".widget-product-carousel-free-download").slick({
  infinite: true,
  slidesToShow: 2,
  slidesToScroll: 2,
  dots: false,
  arrows: true,
  variableWidth: true
});
const platform = navigator?.userAgentData?.platform || navigator?.platform || "";
if (platform.toLowerCase().includes("mac")) {
  document.body.classList.add("mac-os");
}

var collItem = document.getElementsByClassName("collapsible-item");
var i;
for (i = 0; i < collItem.length; i++) {
  collItem[i].addEventListener("click", function () {
    this.classList.toggle("active");
    var content = this.querySelector('.content');;
    if (content.style.display === "block") {
      content.style.display = "none";
    } else {
      content.style.display = "block";
    }
  });
}
  
  $('.customer-welcome .switch').click(function (e) {
    e.preventDefault();
    $(this).closest('.customer-welcome').toggleClass('active');
  });

  $(document).mouseup( function(e){ // событие клика по веб-документу
		var div = $( ".customer-welcome .customer-menu .links"); // тут указываем ID элемента
		if ( !div.is(e.target) // если клик был не по нашему блоку
		    && div.has(e.target).length === 0 ) { // и не по его дочерним элементам
      $('.customer-welcome').removeClass('active');
		}
	});
})